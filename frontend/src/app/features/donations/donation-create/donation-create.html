<!-- src/app/features/donations/donation-create/donation-create.html -->
<div class="create-donation-page">
  <div class="container">
    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title>
          <h1>üçé Cr√©er une donation</h1>
          <p>Partagez vos surplus alimentaires pour √©viter le gaspillage</p>
        </mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <form [formGroup]="donationForm" (ngSubmit)="onSubmit()">
          
          <!-- Titre -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Titre de la donation</mat-label>
            <input 
              matInput 
              formControlName="title"
              placeholder="Ex: Surplus de pain frais"
            >
            <mat-icon matPrefix>title</mat-icon>
            @if (title?.invalid && title?.touched) {
              <mat-error>
                @if (title?.errors?.['required']) {
                  Le titre est requis
                }
                @if (title?.errors?.['minlength']) {
                  Minimum 3 caract√®res
                }
              </mat-error>
            }
          </mat-form-field>

          <!-- Description -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description</mat-label>
            <textarea 
              matInput 
              formControlName="description"
              rows="4"
              placeholder="D√©crivez votre don..."
            ></textarea>
            <mat-icon matPrefix>description</mat-icon>
            @if (description?.invalid && description?.touched) {
              <mat-error>
                @if (description?.errors?.['required']) {
                  La description est requise
                }
                @if (description?.errors?.['minlength']) {
                  Minimum 10 caract√®res
                }
              </mat-error>
            }
          </mat-form-field>

          <!-- Cat√©gorie & Quantit√© -->
          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Cat√©gorie</mat-label>
              <mat-select formControlName="category">
                @for (cat of categories; track cat.value) {
                  <mat-option [value]="cat.value">{{ cat.label }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix>category</mat-icon>
              @if (category?.invalid && category?.touched) {
                <mat-error>La cat√©gorie est requise</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Quantit√©</mat-label>
              <input 
                matInput 
                type="number"
                formControlName="quantity"
                placeholder="10"
              >
              <mat-icon matPrefix>inventory</mat-icon>
              @if (quantity?.invalid && quantity?.touched) {
                <mat-error>Quantit√© invalide</mat-error>
              }
            </mat-form-field>
          </div>

          <!-- Unit√© & Date -->
          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Unit√©</mat-label>
              <mat-select formControlName="unit">
                @for (u of units; track u.value) {
                  <mat-option [value]="u.value">{{ u.label }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix>straighten</mat-icon>
              @if (unit?.invalid && unit?.touched) {
                <mat-error>L'unit√© est requise</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Date de p√©remption</mat-label>
              <input 
                matInput 
                [matDatepicker]="picker"
                formControlName="expiryDate"
                [min]="minDate"
              >
              <mat-icon matPrefix>event</mat-icon>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              @if (expiryDate?.invalid && expiryDate?.touched) {
                <mat-error>La date est requise</mat-error>
              }
            </mat-form-field>
          </div>

          <!-- Adresse de retrait -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Adresse de retrait</mat-label>
            <input 
              matInput 
              formControlName="address"
              placeholder="Ex: Rue Karpala, Ouagadougou"
            >
            <mat-icon matPrefix>location_on</mat-icon>
            @if (address?.invalid && address?.touched) {
              <mat-error>L'adresse est requise</mat-error>
            }
          </mat-form-field>

          <!-- Boutons -->
          <div class="form-actions">
            <button 
              mat-button 
              type="button"
              routerLink="/donations"
              [disabled]="isLoading()"
            >
              Annuler
            </button>

            <button 
              mat-raised-button 
              color="primary"
              type="submit"
              [disabled]="isLoading()"
              class="submit-btn"
            >
              @if (isLoading()) {
                <ng-container>
                  <mat-spinner diameter="20"></mat-spinner>
                  Cr√©ation en cours...
                </ng-container>
              } @else {
                <ng-container>
                  <mat-icon>check</mat-icon>
                  Cr√©er la donation
                </ng-container>
              }
            </button>
          </div>

        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
